import{j as H,r as v,ah as g,o as n,c as f,V as _,P as h,a3 as ee,a as s,n as Q,F as j,a8 as O,U as $,O as L,S as F,J as q,K,u as E,bm as W,bk as X,w as se,T as G,R as te}from"./@vue-b3e19c9c.js";import{S as oe}from"./spark-md5-18b273be.js";import{_ as Y}from"./index-d9849074.js";import{u as ae,b as le}from"./vue-router-1dc8d1b4.js";import"./aplayer-d80f7f58.js";import"./element-plus-a4c2990b.js";import"./lodash-es-2e98bc53.js";import"./@vueuse-1ae0f1a6.js";import"./@element-plus-f64d54a8.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-7b3af433.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-ac9e5c57.js";import"./vue-cookies-9b55b892.js";import"./@highlightjs-38e4bee3.js";import"./highlight.js-0b7b0786.js";import"./axios-a342f982.js";import"./docx-preview-30c6d22b.js";import"./jszip-d9c085e9.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-2320b362.js";import"./vue-336b0872.js";import"./dplayer-ff9c2365.js";import"./vue-clipboard3-abb1cd37.js";import"./clipboard-2fdbe17c.js";const ne=s("span",{class:"iconfont icon-password"},null,-1),ie=s("span",{class:"iconfont icon-password"},null,-1),re={__name:"UpdatePassword",setup(C,{expose:k}){const{proxy:M}=H(),N={updatePassword:"updatePassword"},w=v({}),t=v(),b=(y,i,S)=>{i!==w.value.rePassword?S(new Error(y.message)):S()},V={password:[{required:!0,message:"请输入密码"},{validator:M.Verify.password,message:"密码只能是数字，字母，特殊字符 8-18位"}],rePassword:[{required:!0,message:"请再次输入密码"},{validator:b,message:"两次输入的密码不一致"}]};k({show:()=>{P.value.show=!0,Q(()=>{t.value.resetFields(),w.value={}})}});const P=v({show:!1,title:"修改密码",buttons:[{type:"primary",text:"确定",click:y=>{B()}}]}),B=async()=>{t.value.validate(async y=>{!y||!await M.Request({url:N.updatePassword,params:{password:w.value.password}})||(P.value.show=!1,M.Message.success("密码修改成功"))})};return(y,i)=>{const S=g("el-input"),D=g("el-form-item"),U=g("el-form"),l=g("Dialog");return n(),f("div",null,[_(l,{show:P.value.show,title:P.value.title,buttons:P.value.buttons,width:"500px",showCancel:!0,onClose:i[3]||(i[3]=a=>P.value.show=!1)},{default:h(()=>[_(U,{model:w.value,rules:V,ref_key:"formDataRef",ref:t,"label-width":"80px",onSubmit:i[2]||(i[2]=ee(()=>{},["prevent"]))},{default:h(()=>[_(D,{label:"新密码",prop:"password"},{default:h(()=>[_(S,{type:"password",size:"large",placeholder:"请输入密码",modelValue:w.value.password,"onUpdate:modelValue":i[0]||(i[0]=a=>w.value.password=a),"show-password":""},{prefix:h(()=>[ne]),_:1},8,["modelValue"])]),_:1}),_(D,{label:"确认密码",prop:"rePassword"},{default:h(()=>[_(S,{type:"password",size:"large",placeholder:"请再次输入密码",modelValue:w.value.rePassword,"onUpdate:modelValue":i[1]||(i[1]=a=>w.value.rePassword=a),"show-password":""},{prefix:h(()=>[ie]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}};const ce=C=>(W("data-v-c4b41b7f"),C=C(),X(),C),ue={class:"uploader-panel"},de=ce(()=>s("div",{class:"uploader-title"},[s("span",null,"上传任务"),s("span",{class:"tips"},"（仅展示本次上传任务）")],-1)),pe={class:"file-list"},_e={class:"file-item"},me={class:"upload-panel"},fe={class:"file-name"},ve={class:"progress"},he={class:"upload-status"},we={key:0,class:"upload-info"},ge={class:"op"},ke={class:"op-btn"},ye={key:0},Se={key:0},I=1024*512,Ce={__name:"Uploader",emits:["uploadCallback"],setup(C,{expose:k,emit:M}){const{proxy:N}=H(),w={upload:"/file/uploadFile"},t={emptyfile:{value:"emptyfile",desc:"文件为空",color:"#F75000",icon:"close"},fail:{value:"fail",desc:"上传失败",color:"#F75000",icon:"close"},init:{value:"init",desc:"解析中",color:"#e6a23c",icon:"clock"},uploading:{value:"uploading",desc:"上传中",color:"#409eff",icon:"upload"},upload_finish:{value:"upload_finish",desc:"上传完成",color:"#67c23a",icon:"ok"},upload_seconds:{value:"upload_seconds",desc:"秒传",color:"#67c23a",icon:"ok"}},b=v([]),V=v([]);k({addFile:async(l,a)=>{const o={file:l,uid:l.uid,md5Progress:0,md5:null,fileName:l.name,status:t.init.value,uploadSize:0,totalSize:l.size,uploadProgress:0,pause:!1,chunkIndex:0,filePid:a,errorMsg:null};if(b.value.unshift(o),o.totalSize==0){o.status=t.emptyfile.value;return}let u=await D(o);u!=null&&S(u)}});const P=l=>{let a=U(l);a.pause=!1,S(l,a.chunkIndex)},B=l=>{let a=U(l);a.pause=!0},y=(l,a)=>{V.value.push(l),b.value.splice(a,1)},i=M,S=async(l,a)=>{a=a||0;let o=U(l);const u=o.file,d=o.totalSize,e=Math.ceil(d/I);for(let r=a;r<e;r++){let m=V.value.indexOf(l);if(m!=-1){V.value.splice(m,1);break}if(o=U(l),o.pause)break;let p=r*I,T=p+I>=d?d:p+I,x=u.slice(p,T),z=await N.Request({url:w.upload,showLoading:!1,dataType:"file",params:{file:x,fileName:u.name,fileMd5:o.md5,chunkIndex:r,chunks:e,fileId:o.fileId,filePid:o.filePid},showError:!1,errorCallback:R=>{o.status=t.fail.value,o.errorMsg=R},uploadProgressCallback:R=>{let c=R.loaded;c>d&&(c=d),o.uploadSize=r*I+c,o.uploadProgress=Math.floor(o.uploadSize/d*100)}});if(z==null)break;if(o.fileId=z.data.fileId,o.status=t[z.data.status].value,o.chunkIndex=r,z.data.status==t.upload_seconds.value||z.data.status==t.upload_finish.value){o.uploadProgress=100,i("uploadCallback");break}}},D=l=>{let a=l.file,o=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,u=Math.ceil(a.size/I),d=0,e=new oe.ArrayBuffer,r=new FileReader;new Date().getTime();let m=()=>{let p=d*I,T=p+I>=a.size?a.size:p+I;r.readAsArrayBuffer(o.call(a,p,T))};return m(),new Promise((p,T)=>{let x=U(a.uid);r.onload=z=>{if(e.append(z.target.result),d++,d<u){let R=Math.floor(d/u*100);x.md5Progress=R,m()}else{let R=e.end();e.destroy(),x.md5Progress=100,x.status=t.uploading.value,x.md5=R,p(l.uid)}},r.onerror=()=>{x.md5Progress=-1,x.status=t.fail.value,p(l.uid)}}).catch(p=>null)},U=l=>b.value.find(o=>o.file.uid===l);return(l,a)=>{const o=g("el-progress"),u=g("icon"),d=g("NoData");return n(),f("div",ue,[de,s("div",pe,[(n(!0),f(j,null,O(b.value,(e,r)=>(n(),f("div",_e,[s("div",me,[s("div",fe,$(e.fileName),1),s("div",ve,[e.status==t.uploading.value||e.status==t.upload_seconds.value||e.status==t.upload_finish.value?(n(),L(o,{key:0,percentage:e.uploadProgress},null,8,["percentage"])):F("",!0)]),s("div",he,[s("span",{class:q(["iconfont","icon-"+t[e.status].icon]),style:K({color:t[e.status].color})},null,6),s("span",{class:"status",style:K({color:t[e.status].color})},$(e.status=="fail"?e.errorMsg:t[e.status].desc),5),e.status==t.uploading.value?(n(),f("span",we,$(E(N).Utils.size2Str(e.uploadSize))+"/"+$(E(N).Utils.size2Str(e.totalSize)),1)):F("",!0)])]),s("div",ge,[e.status==t.init.value?(n(),L(o,{key:0,type:"circle",width:50,percentage:e.md5Progress},null,8,["percentage"])):F("",!0),s("div",ke,[e.status===t.uploading.value?(n(),f("span",ye,[e.pause?(n(),L(u,{key:0,width:28,class:"btn-item",iconName:"upload",title:"上传",onClick:m=>P(e.uid)},null,8,["onClick"])):(n(),L(u,{key:1,width:28,class:"btn-item",iconName:"pause",title:"暂停",onClick:m=>B(e.uid)},null,8,["onClick"]))])):F("",!0),e.status!=t.init.value&&e.status!=t.upload_finish.value&&e.status!=t.upload_seconds.value?(n(),L(u,{key:1,width:28,class:"del btn-item",iconName:"del",title:"删除",onClick:m=>y(e.uid,r)},null,8,["onClick"])):F("",!0),e.status==t.upload_finish.value||e.status==t.upload_seconds.value?(n(),L(u,{key:2,width:28,class:"clean btn-item",iconName:"clean",title:"清除",onClick:m=>y(e.uid,r)},null,8,["onClick"])):F("",!0)])])]))),256)),b.value.length==0?(n(),f("div",Se,[_(d,{msg:"暂无上传任务"})])):F("",!0)])])}}},be=Y(Ce,[["__scopeId","data-v-c4b41b7f"]]);const J=C=>(W("data-v-e9c8c5c5"),C=C(),X(),C),Pe={class:"framework"},xe={class:"header"},Fe=J(()=>s("div",{class:"logo"},[s("span",{class:"name"},"个人网盘")],-1)),$e={class:"right-panel"},Ue=J(()=>s("span",{class:"iconfont icon-transfer"},null,-1)),ze={class:"user-info",style:{"margin-left":"50px","margin-right":"30px"}},Re={class:"nick-name"},Ie={class:"body"},Me={class:"left-sider"},Ne={class:"menu-list"},Ve=["onClick"],De={class:"text"},Le={class:"menu-sub-list"},Be=["onClick"],Te={class:"text"},qe={key:0,class:"tips"},Ae={class:"space-info"},je=J(()=>s("div",null,"空间容量",-1)),Ee={class:"percent"},Oe={class:"space-use"},He={class:"use"},Je={class:"body-content"},Ke={__name:"Framework",setup(C){const{proxy:k}=H(),M=ae(),N=le(),w={getUseSpace:"/getUseSpace",logout:"/logout"},t=v(!1),b=v(),V=e=>{const{file:r,filePid:m}=e;t.value=!0,b.value.addFile(r,m)},A=v(),P=()=>{Q(()=>{A.value.reload(),d()})};v(0);const B=v(k.VueCookies.get("userInfo")),y=[{name:"首页",menuCode:"main",path:"/main/all",allShow:!0,children:[{name:"全部",category:"all",path:"/main/all"},{name:"视频",category:"video",path:"/main/video"},{name:"音频",category:"music",path:"/main/music"},{name:"相册",category:"image",path:"/main/image"},{name:"文档",category:"doc",path:"/main/doc"},{name:"其他",category:"others",path:"/main/others"}]},{path:"/myshare",name:"分享",menuCode:"share",allShow:!0,children:[{name:"分享记录",path:"/myshare"}]},{path:"/recycle",name:"回收站",menuCode:"recycle",tips:"回收站为你保存10天内删除的文件",allShow:!0,children:[{name:"删除的文件",path:"/recycle"}]},{path:"/settings/fileList",name:"设置",menuCode:"settings",allShow:!1,children:[{name:"用户文件",path:"/settings/fileList"},{name:"用户管理",path:"/settings/userList"},{path:"/settings/sysSetting",name:"系统设置"}]}],i=v({}),S=v(),D=e=>{!e.path||e.menuCode==i.value.menuCode||M.push(e.path)},U=(e,r)=>{const m=y.find(p=>p.menuCode===e);i.value=m,S.value=r};se(()=>N,(e,r)=>{e.meta.menuCode&&U(e.meta.menuCode,e.path)},{immediate:!0,deep:!0});const l=v(),a=()=>{l.value.show()},o=()=>{k.Confirm("你确定要删除退出吗",async()=>{await k.Request({url:w.logout})&&(k.VueCookies.remove("userInfo"),M.push("/login"))})},u=v({useSpace:0,totalSpace:1}),d=async()=>{let e=await k.Request({url:w.getUseSpace,showLoading:!1});e&&(u.value=e.data)};return d(),(e,r)=>{const m=g("el-popover"),p=g("el-dropdown-item"),T=g("el-dropdown-menu"),x=g("el-dropdown"),z=g("el-progress"),R=g("router-view");return n(),f("div",Pe,[s("div",xe,[Fe,s("div",$e,[_(m,{width:800,trigger:"click",visible:t.value,"onUpdate:visible":r[0]||(r[0]=c=>t.value=c),offset:20,transition:"none","hide-after":0,"popper-style":{padding:"0px"}},{reference:h(()=>[Ue]),default:h(()=>[_(be,{ref_key:"uploaderRef",ref:b,onUploadCallback:P},null,512)]),_:1},8,["visible"]),_(x,null,{dropdown:h(()=>[_(T,null,{default:h(()=>[_(p,{onClick:a},{default:h(()=>[G(" 修改密码 ")]),_:1}),_(p,{onClick:o},{default:h(()=>[G(" 退出 ")]),_:1})]),_:1})]),default:h(()=>[s("div",ze,[s("span",Re,$(B.value.nickName),1)])]),_:1})])]),s("div",Ie,[s("div",Me,[s("div",Ne,[(n(),f(j,null,O(y,c=>(n(),f(j,null,[c.allShow||!c.allShow&&B.value.admin?(n(),f("div",{key:0,onClick:Z=>D(c),class:q(["menu-item",c.menuCode==i.value.menuCode?"active":""])},[s("div",{class:q(["iconfont","icon-"+c.icon])},null,2),s("div",De,$(c.name),1)],10,Ve)):F("",!0)],64))),64))]),s("div",Le,[(n(!0),f(j,null,O(i.value.children,c=>(n(),f("div",{onClick:Z=>D(c),class:q(["menu-item-sub",S.value==c.path?"active":""])},[c.icon?(n(),f("span",{key:0,class:q(["iconfont","icon-"+c.icon])},null,2)):F("",!0),s("span",Te,$(c.name),1)],10,Be))),256)),i.value&&i.value.tips?(n(),f("div",qe,$(i.value.tips),1)):F("",!0),s("div",Ae,[je,s("div",Ee,[_(z,{percentage:Math.floor(u.value.useSpace/u.value.totalSpace*1e4)/100,color:"#409eff"},null,8,["percentage"])]),s("div",Oe,[s("div",He,$(E(k).Utils.size2Str(u.value.useSpace))+"/ "+$(E(k).Utils.size2Str(u.value.totalSpace)),1),s("div",{class:"iconfont icon-refresh",onClick:d})])])])]),s("div",Je,[_(R,null,{default:h(({Component:c})=>[(n(),L(te(c),{onAddFile:V,ref_key:"routerViewRef",ref:A,onReload:d},null,544))]),_:1})])]),_(re,{ref_key:"updatePasswordRef",ref:l},null,512)])}}},Ss=Y(Ke,[["__scopeId","data-v-e9c8c5c5"]]);export{Ss as default};
