import{j as F,r as _,k as O,_ as K,ah as C,o as m,c as y,a as r,V as t,P as o,n as z,O as b,S as p,T as R,a9 as A,a3 as G,U as H,bm as J,bk as Q}from"./@vue-b3e19c9c.js";import{u as W,b as X}from"./vue-router-1dc8d1b4.js";import{m as Y}from"./js-md5-cda431b7.js";import{_ as Z}from"./index-d9849074.js";import"./aplayer-d80f7f58.js";import"./element-plus-a4c2990b.js";import"./lodash-es-2e98bc53.js";import"./@vueuse-1ae0f1a6.js";import"./@element-plus-f64d54a8.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-7b3af433.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-ac9e5c57.js";import"./vue-cookies-9b55b892.js";import"./@highlightjs-38e4bee3.js";import"./highlight.js-0b7b0786.js";import"./axios-a342f982.js";import"./docx-preview-30c6d22b.js";import"./jszip-d9c085e9.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-2320b362.js";import"./vue-336b0872.js";import"./dplayer-ff9c2365.js";import"./vue-clipboard3-abb1cd37.js";import"./clipboard-2fdbe17c.js";const c=M=>(J("data-v-47a22a19"),M=M(),Q(),M),ee={class:"login-body"},oe=c(()=>r("div",{class:"bg"},null,-1)),se={class:"login-panel"},le=c(()=>r("div",{class:"login-title"},"个人网盘",-1)),ae=c(()=>r("span",{class:"iconfont icon-account"},null,-1)),te=c(()=>r("span",{class:"iconfont icon-password"},null,-1)),re={key:1},ie={class:"send-emali-panel"},de=c(()=>r("span",{class:"iconfont icon-checkcode"},null,-1)),ne=c(()=>r("span",{class:"iconfont icon-account"},null,-1)),ue=c(()=>r("span",{class:"iconfont icon-password"},null,-1)),me=c(()=>r("span",{class:"iconfont icon-password"},null,-1)),ce={class:"check-code-panel"},pe=c(()=>r("span",{class:"iconfont icon-checkcode"},null,-1)),fe=["src"],ve={class:"rememberme-panel"},_e={class:"no-account"},ge={key:0},ke={key:1},we={key:2},Ce={class:"check-code-panel"},he=c(()=>r("span",{class:"iconfont icon-checkcode"},null,-1)),Ve=["src"],ye={__name:"Login",setup(M){const{proxy:u}=F(),N=W(),j=X(),g={checkCode:"/api/checkCode",sendMailCode:"/sendEmailCode",register:"/register",login:"/login",resetPwd:"/resetPwd"},a=_(1),f=i=>{a.value=i,E()};O(()=>{f(1)});const L=(i,e,d)=>{e!==l.value.registerPassword?d(new Error(i.message)):d()},l=_({}),x=_(),U={email:[{required:!0,message:"请输入邮箱"},{validator:u.Verify.email,message:"请输入正确的邮箱"}],password:[{required:!0,message:"请输入密码"}],emailCode:[{required:!0,message:"请输入邮箱验证码"}],nickName:[{required:!0,message:"请输入昵称"}],registerPassword:[{required:!0,message:"请输入密码"},{validator:u.Verify.password,message:"密码只能是数字，字母，特殊字符 8-18位"}],reRegisterPassword:[{required:!0,message:"请再次输入密码"},{validator:L,message:"两次输入的密码不一致"}],checkCode:[{required:!0,message:"请输入图片验证码"}]},I=_(),S=_(),k=i=>{i==0?I.value=g.checkCode+"?type="+i+"&time="+new Date().getTime():S.value=g.checkCode+"?type="+i+"&time="+new Date().getTime()},h=_({}),P=_(),w=K({show:!1,title:"发送邮箱验证码",buttons:[{type:"primary",text:"发送验证码",click:()=>{T()}}]}),$=()=>{x.value.validateField("email",i=>{i&&(w.show=!0,z(()=>{k(1),P.value.resetFields(),h.value={email:l.value.email}}))})},T=()=>{P.value.validate(async i=>{if(!i)return;const e=Object.assign({},h.value);e.type=a.value==0?0:1,await u.Request({url:g.sendMailCode,params:e,errorCallback:()=>{k(1)}})&&(u.Message.success("验证码发送成功，请登录邮箱查看"),w.show=!1)})},E=()=>{z(()=>{if(k(0),x.value.resetFields(),l.value={},a.value==1){const i=u.VueCookies.get("loginInfo");i&&(l.value=i)}})},D=()=>{x.value.validate(async i=>{if(!i)return;let e={};if(Object.assign(e,l.value),(a.value==0||a.value==2)&&(e.password=e.registerPassword,delete e.registerPassword,delete e.reRegisterPassword),a.value==1){let v=u.VueCookies.get("loginInfo"),V=v==null?null:v.password;e.password!==V&&(e.password=Y(e.password))}let d=null;a.value==0?d=g.register:a.value==1?d=g.login:a.value==2&&(d=g.resetPwd);let n=await u.Request({url:d,params:e,errorCallback:()=>{k(0)}});if(n)if(a.value==0)u.Message.success("注册成功,请登录"),f(1);else if(a.value==1){if(e.rememberMe){const V={email:e.email,password:e.password,rememberMe:e.rememberMe};u.VueCookies.set("loginInfo",V,"7d")}else u.VueCookies.remove("loginInfo");u.Message.success("登录成功"),u.VueCookies.set("userInfo",n.data,0);const v=j.query.redirectUrl||"/";N.push(v)}else a.value==2&&(u.Message.success("重置密码成功,请登录"),f(1))})};return(i,e)=>{const d=C("el-input"),n=C("el-form-item"),v=C("el-button"),V=C("el-checkbox"),q=C("el-form"),B=C("Dialog");return m(),y("div",ee,[oe,r("div",se,[t(q,{class:"login-register",model:l.value,rules:U,ref_key:"formDataRef",ref:x},{default:o(()=>[le,t(n,{prop:"email"},{default:o(()=>[t(d,{size:"large",clearable:"",placeholder:"请输入邮箱",modelValue:l.value.email,"onUpdate:modelValue":e[0]||(e[0]=s=>l.value.email=s),modelModifiers:{trim:!0},maxLength:"150"},{prefix:o(()=>[ae]),_:1},8,["modelValue"])]),_:1}),a.value==1?(m(),b(n,{key:0,prop:"password"},{default:o(()=>[t(d,{type:"password",size:"large",placeholder:"请输入密码",modelValue:l.value.password,"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.password=s),modelModifiers:{trim:!0},"show-password":""},{prefix:o(()=>[te]),_:1},8,["modelValue"])]),_:1})):p("",!0),a.value==0||a.value==2?(m(),y("div",re,[t(n,{prop:"emailCode"},{default:o(()=>[r("div",ie,[t(d,{size:"large",placeholder:"请输入邮箱验证码",modelValue:l.value.emailCode,"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.emailCode=s),modelModifiers:{trim:!0}},{prefix:o(()=>[de]),_:1},8,["modelValue"]),t(v,{class:"send-mail-btn",type:"primary",size:"large",onClick:$},{default:o(()=>[R("获取验证码")]),_:1})])]),_:1}),a.value==0?(m(),b(n,{key:0,prop:"nickName"},{default:o(()=>[t(d,{size:"large",clearable:"",placeholder:"请输入昵称",modelValue:l.value.nickName,"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.nickName=s),modelModifiers:{trim:!0},maxLength:"20"},{prefix:o(()=>[ne]),_:1},8,["modelValue"])]),_:1})):p("",!0),t(n,{prop:"registerPassword"},{default:o(()=>[t(d,{type:"password",size:"large",placeholder:"请输入密码",modelValue:l.value.registerPassword,"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.registerPassword=s),modelModifiers:{trim:!0},"show-password":""},{prefix:o(()=>[ue]),_:1},8,["modelValue"])]),_:1}),t(n,{prop:"reRegisterPassword"},{default:o(()=>[t(d,{type:"password",size:"large",placeholder:"请再次输入密码",modelValue:l.value.reRegisterPassword,"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.reRegisterPassword=s),modelModifiers:{trim:!0},"show-password":""},{prefix:o(()=>[me]),_:1},8,["modelValue"])]),_:1})])):p("",!0),t(n,{prop:"checkCode"},{default:o(()=>[r("div",ce,[t(d,{size:"large",placeholder:"请输入验证码",modelValue:l.value.checkCode,"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.checkCode=s),modelModifiers:{trim:!0},onKeyup:A(D,["enter"])},{prefix:o(()=>[pe]),_:1},8,["modelValue"]),r("img",{src:I.value,class:"check-code",onClick:e[7]||(e[7]=s=>k(0))},null,8,fe)])]),_:1}),a.value==1?(m(),b(n,{key:2},{default:o(()=>[r("div",ve,[t(V,{modelValue:l.value.rememberMe,"onUpdate:modelValue":e[8]||(e[8]=s=>l.value.rememberMe=s)},{default:o(()=>[R("记住我")]),_:1},8,["modelValue"])]),r("div",_e,[r("a",{href:"javascript:void(0)",class:"a-link",onClick:e[9]||(e[9]=s=>f(2))},"找回密码"),r("a",{href:"javascript:void(0)",class:"a-link",onClick:e[10]||(e[10]=s=>f(0))},"注册新账号")])]),_:1})):p("",!0),a.value==0?(m(),b(n,{key:3},{default:o(()=>[r("a",{href:"javascript:void(0)",class:"a-link",onClick:e[11]||(e[11]=s=>f(1))},"已有账号?")]),_:1})):p("",!0),a.value==2?(m(),b(n,{key:4},{default:o(()=>[r("a",{href:"javascript:void(0)",class:"a-link",onClick:e[12]||(e[12]=s=>f(1))},"去登录?")]),_:1})):p("",!0),t(n,null,{default:o(()=>[t(v,{type:"primary",class:"op-btn",onClick:D,size:"large"},{default:o(()=>[a.value==0?(m(),y("span",ge,"注册")):p("",!0),a.value==1?(m(),y("span",ke,"登录")):p("",!0),a.value==2?(m(),y("span",we,"重置密码")):p("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),t(B,{show:w.show,title:w.title,buttons:w.buttons,width:"500px",showCancel:!1,onClose:e[16]||(e[16]=s=>w.show=!1)},{default:o(()=>[t(q,{model:h.value,rules:U,ref_key:"formData4SendMailCodeRef",ref:P,"label-width":"80px",onSubmit:e[15]||(e[15]=G(()=>{},["prevent"]))},{default:o(()=>[t(n,{label:"邮箱"},{default:o(()=>[R(H(l.value.email),1)]),_:1}),t(n,{label:"验证码",prop:"checkCode"},{default:o(()=>[r("div",Ce,[t(d,{size:"large",placeholder:"请输入验证码",modelValue:h.value.checkCode,"onUpdate:modelValue":e[13]||(e[13]=s=>h.value.checkCode=s),modelModifiers:{trim:!0}},{prefix:o(()=>[he]),_:1},8,["modelValue"]),r("img",{src:S.value,class:"check-code",onClick:e[14]||(e[14]=s=>k(1))},null,8,Ve)])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}},Ye=Z(ye,[["__scopeId","data-v-47a22a19"]]);export{Ye as default};
