import{j as oe,r as n,ah as p,o as r,c as y,V as t,P as o,a3 as se,T as f,U as x,F as j,O,S as w,u as ie,n as Y,b as be,a as c,a9 as ae,J as we,bm as ke,bk as Fe}from"./@vue-b3e19c9c.js";import{u as Ce}from"./vue-clipboard3-abb1cd37.js";import{i as Ie}from"./vue-qrcode-6bc23c38.js";import{u as Ne,b as xe}from"./vue-router-1dc8d1b4.js";import{_ as Te}from"./index-d9849074.js";import"./clipboard-2fdbe17c.js";import"./aplayer-d80f7f58.js";import"./qrcode-9719fc56.js";import"./encode-utf8-f813de00.js";import"./dijkstrajs-f906a09e.js";import"./element-plus-a4c2990b.js";import"./lodash-es-2e98bc53.js";import"./@vueuse-1ae0f1a6.js";import"./@element-plus-f64d54a8.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-7b3af433.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-ac9e5c57.js";import"./vue-cookies-9b55b892.js";import"./@highlightjs-38e4bee3.js";import"./highlight.js-0b7b0786.js";import"./axios-a342f982.js";import"./docx-preview-30c6d22b.js";import"./jszip-d9c085e9.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-2320b362.js";import"./vue-336b0872.js";import"./dplayer-ff9c2365.js";const Se={all:{accept:"*"},video:{accept:".mp4,.avi,.rmvb,.mkv,.mov"},music:{accept:".mp3,.wav,.wma,.mp2,.flac,.midi,.ra,.ape,.aac,.cda"},image:{accept:".jpeg,.jpg,.png,.gif,.bmp,.dds,.psd,.pdt,.webp,.xmp,.svg,.tiff"},doc:{accept:".pdf,.doc,.docx,.xls,.xlsx,.txt"},others:{accept:"*"}},Re={__name:"ShareFile",setup(S,{expose:K}){const{toClipboard:A}=Ce(),{proxy:d}=oe(),R=n(document.location.origin+"/share/"),H={shareFile:"/share/shareFile"},z=n(0),u=n({}),v=n(),J={validType:[{required:!0,message:"请选择有效期"}],codeType:[{required:!0,message:"请选择提取码类型"}],code:[{required:!0,message:"请输入提取码"},{validator:d.Verify.shareCode,message:"提取码只能是数字字母"},{min:5,message:"提取码最少5位"}]},V=n(!0),g=n({show:!1,title:"分享",buttons:[{type:"primary",text:"确定",click:b=>{G()}}]}),s=n({}),G=async()=>{if(Object.keys(s.value).length>0){g.value.show=!1;return}v.value.validate(async b=>{if(!b)return;let i={};Object.assign(i,u.value);let m=await d.Request({url:H.shareFile,params:i});m&&(z.value=1,s.value=m.data,g.value.buttons[0].text="关闭",V.value=!1)})};K({show:b=>{V.value=!0,g.value.show=!0,z.value=0,s.value={},Y(()=>{v.value.resetFields(),u.value=Object.assign({},b)})}});const T=async()=>{await A(`链接:${R.value}${s.value.shareId} 提取码: ${s.value.code}`),d.Message.success("复制成功")};return(b,i)=>{const m=p("el-form-item"),F=p("el-radio"),k=p("el-radio-group"),D=p("el-input"),Q=p("el-button"),W=p("el-form"),U=p("Dialog");return r(),y("div",null,[t(U,{show:g.value.show,title:g.value.title,buttons:g.value.buttons,width:"600px",showCancel:V.value,onClose:i[4]||(i[4]=C=>g.value.show=!1)},{default:o(()=>[t(W,{model:u.value,rules:J,ref_key:"formDataRef",ref:v,"label-width":"100px",onSubmit:i[3]||(i[3]=se(()=>{},["prevent"]))},{default:o(()=>[t(m,{label:"文件"},{default:o(()=>[f(x(u.value.fileName),1)]),_:1}),z.value==0?(r(),y(j,{key:0},[t(m,{label:"有效期",prop:"validType"},{default:o(()=>[t(k,{modelValue:u.value.validType,"onUpdate:modelValue":i[0]||(i[0]=C=>u.value.validType=C)},{default:o(()=>[t(F,{label:0},{default:o(()=>[f("1天")]),_:1}),t(F,{label:1},{default:o(()=>[f("7天")]),_:1}),t(F,{label:2},{default:o(()=>[f("30天")]),_:1}),t(F,{label:3},{default:o(()=>[f("永久有效")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"提取码",prop:"codeType"},{default:o(()=>[t(k,{modelValue:u.value.codeType,"onUpdate:modelValue":i[1]||(i[1]=C=>u.value.codeType=C)},{default:o(()=>[t(F,{label:0},{default:o(()=>[f("自定义")]),_:1}),t(F,{label:1},{default:o(()=>[f("系统生成")]),_:1})]),_:1},8,["modelValue"])]),_:1}),u.value.codeType==0?(r(),O(m,{key:0,prop:"code"},{default:o(()=>[t(D,{clearable:"",placeholder:"请输入5位提取码",modelValue:u.value.code,"onUpdate:modelValue":i[2]||(i[2]=C=>u.value.code=C),modelModifiers:{trim:!0},maxLength:"5",style:{width:"130px"}},null,8,["modelValue"])]),_:1})):w("",!0)],64)):(r(),y(j,{key:1},[t(m,{label:"分享连接"},{default:o(()=>[f(x(R.value)+x(s.value.shareId),1)]),_:1}),t(m,{label:"提取码"},{default:o(()=>[f(x(s.value.code),1)]),_:1}),t(m,null,{default:o(()=>[t(Q,{type:"primary",onClick:T},{default:o(()=>[f("复制链接及提取码")]),_:1})]),_:1}),t(m,null,{default:o(()=>[t(ie(Ie),{value:`${R.value}${s.value.shareId}`,options:{width:200}},null,8,["value"])]),_:1})],64))]),_:1},8,["model"])]),_:1},8,["show","title","buttons","showCancel"])])}}};const B=S=>(ke("data-v-efbb7b35"),S=S(),Fe(),S),Ve={class:"top"},De={class:"top-op"},$e={class:"btn"},Ee=B(()=>c("span",{class:"iconfont icon-upload"},null,-1)),Me=B(()=>c("span",{class:"iconfont icon-folder-add"},null,-1)),Oe=B(()=>c("span",{class:"iconfont icon-del"},null,-1)),ze=B(()=>c("span",{class:"iconfont icon-move"},null,-1)),Pe={class:"search-panel"},Ue={key:0,class:"file-list"},qe=["onMouseenter","onMouseleave"],Le=["title"],je=["onClick"],Be={key:3,class:"edit-panel"},Ke=["onClick"],Ae=["onClick"],He={class:"op"},Je=["onClick"],Ge=["onClick"],Qe=["onClick"],We=["onClick"],Xe=["onClick"],Ye={key:0},Ze={__name:"Main",emits:["addFile"],setup(S,{expose:K,emit:A}){const{proxy:d}=oe();Ne(),xe();const R=A,H=async e=>{R("addFile",{file:e.file,filePid:u.value.fileId})};K({reload:()=>{T.value=!1,i()}});const u=n({fileId:0}),v={loadDataList:"/file/loadDataList",rename:"/file/rename",newFoloder:"/file/newFoloder",getFolderInfo:"/file/getFolderInfo",delFile:"/file/delFile",changeFileFolder:"/file/changeFileFolder",createDownloadUrl:"/file/createDownloadUrl",download:"/api/file/download"},J=be(()=>{const e=Se[b.value];return e?e.accept:"*"}),V=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"修改时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200}],g=()=>{T.value=!0,i()},s=n({}),G={extHeight:50,selectType:"checkbox"},P=n(),T=n(!0),b=n(),i=async()=>{let e={pageNo:s.value.pageNo,pageSize:s.value.pageSize,fileNameFuzzy:P.value,category:b.value,filePid:u.value.fileId};e.category!=="all"&&delete e.filePid;let l=await d.Request({url:v.loadDataList,showLoading:T,params:e});l&&(s.value=l.data,k.value=!1)},m=e=>{s.value.list.forEach(l=>{l.showOp=!1}),e.showOp=!0},F=e=>{e.showOp=!1},k=n(!1),D=n(),Q=()=>{k.value||(s.value.list.forEach(e=>{e.showEdit=!1}),k.value=!0,s.value.list.unshift({showEdit:!0,fileType:0,fileId:"",filePid:u.value.fileId}),Y(()=>{D.value.focus()}))},W=e=>{const l=s.value.list[e];l.fileId?l.showEdit=!1:s.value.list.splice(e,1),k.value=!1},U=async e=>{const{fileId:l,filePid:h,fileNameReal:E}=s.value.list[e];if(E==""||E.indexOf("/")!=-1){d.Message.warning("文件名不能为空且不能含有斜杠");return}let M=v.rename;l==""&&(M=v.newFoloder);let L=await d.Request({url:M,params:{fileId:l,filePid:h,fileName:E}});L&&(s.value.list[e]=L.data,k.value=!1)},C=e=>{s.value.list[0].fileId==""&&(s.value.list.splice(0,1),e=e-1),s.value.list.forEach(h=>{h.showEdit=!1});let l=s.value.list[e];l.showEdit=!0,l.folderType==0?(l.fileNameReal=l.fileName.substring(0,l.fileName.indexOf(".")),l.fileSuffix=l.fileName.substring(l.fileName.indexOf("."))):(l.fileNameReal=l.fileName,l.fileSuffix=""),k.value=!0,Y(()=>{D.value.focus()})},I=n([]),Z=n([]),ne=e=>{Z.value=e,I.value=[],e.forEach(l=>{I.value.push(l.fileId)})},ce=e=>{d.Confirm(`你确定要删除【${e.fileName}】吗？删除的文件可在10天内通过回收站还原`,async()=>{await d.Request({url:v.delFile,params:{fileIds:e.fileId}})&&i()})},ue=()=>{I.value.length!=0&&d.Confirm("你确定要删除这些文件吗？删除的文件可在10天内通过回收站还原",async()=>{await d.Request({url:v.delFile,params:{fileIds:I.value.join(",")}})&&i()})},q=n(),$=n({}),re=e=>{$.value=e,q.value.showFolderDialog(e.fileId)},de=()=>{$.value={};const e=[u.value.fileId];Z.value.forEach(l=>{l.folderType==1&&e.push(l.fileId)}),q.value.showFolderDialog(e.join(","))},fe=async e=>{if($.value.filePid===e||u.value.fileId==e){d.Message.warning("文件正在当前目录，无需移动");return}let l=[];$.value.fileId?l.push($.value.fileId):l=l.concat(I.value),await d.Request({url:v.changeFileFolder,params:{fileIds:l.join(","),filePid:e}})&&(q.value.close(),i())},ee=n(),le=n(),pe=e=>{if(e.folderType==1){le.value.openFolder(e);return}ee.value.showPreview(e,0)},me=e=>{const{curFolder:l,categoryId:h}=e;u.value=l,T.value=!0,b.value=h,i()},ve=async e=>{let l=await d.Request({url:v.createDownloadUrl+"/"+e.fileId});l&&(window.location.href=v.download+"/"+l.data)},te=n(),_e=e=>{te.value.show(e)};return(e,l)=>{const h=p("el-button"),E=p("el-upload"),M=p("el-input"),L=p("Navigation"),X=p("icon"),he=p("Table"),ye=p("Preview"),ge=p("FolderSelect");return r(),y("div",null,[c("div",Ve,[c("div",De,[c("div",$e,[t(E,{"show-file-list":!1,"with-credentials":!0,multiple:!0,"http-request":H,accept:J.value},{default:o(()=>[t(h,{type:"primary"},{default:o(()=>[Ee,f(" 上传 ")]),_:1})]),_:1},8,["accept"])]),b.value=="all"?(r(),O(h,{key:0,type:"success",onClick:Q},{default:o(()=>[Me,f(" 新建文件夹 ")]),_:1})):w("",!0),t(h,{onClick:ue,type:"danger",disabled:I.value.length==0},{default:o(()=>[Oe,f(" 删除 ")]),_:1},8,["disabled"]),t(h,{onClick:de,type:"warning",disabled:I.value.length==0},{default:o(()=>[ze,f(" 移动 ")]),_:1},8,["disabled"]),c("div",Pe,[t(M,{clearable:"",placeholder:"输入文件名搜索",modelValue:P.value,"onUpdate:modelValue":l[0]||(l[0]=N=>P.value=N),onKeyup:ae(g,["enter"])},{suffix:o(()=>[c("i",{class:"iconfont icon-search",onClick:g})]),_:1},8,["modelValue"])]),c("div",{class:"iconfont icon-refresh",onClick:i})]),t(L,{ref_key:"navigationRef",ref:le,onNavChange:me},null,512)]),s.value.list&&s.value.list.length>0?(r(),y("div",Ue,[t(he,{ref:"dataTableRef",columns:V,showPagination:!0,dataSource:s.value,fetch:i,initFetch:!1,options:G,onRowSelected:ne},{fileName:o(({index:N,row:a})=>[c("div",{class:"file-item",onMouseenter:_=>m(a),onMouseleave:_=>F(a)},[(a.fileType==3||a.fileType==1)&&a.status==2?(r(),O(X,{key:0,cover:a.fileCover,width:32},null,8,["cover"])):(r(),y(j,{key:1},[a.folderType==0?(r(),O(X,{key:0,fileType:a.fileType},null,8,["fileType"])):w("",!0),a.folderType==1?(r(),O(X,{key:1,fileType:0})):w("",!0)],64)),a.showEdit?w("",!0):(r(),y("span",{key:2,class:"file-name",title:a.fileName},[c("span",{onClick:_=>pe(a)},x(a.fileName),9,je)],8,Le)),a.showEdit?(r(),y("div",Be,[t(M,{modelValue:a.fileNameReal,"onUpdate:modelValue":_=>a.fileNameReal=_,modelModifiers:{trim:!0},ref_key:"editNameRef",ref:D,maxLength:190,onKeyup:ae(_=>U(N),["enter"])},{suffix:o(()=>[f(x(a.fileSuffix),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"]),c("span",{class:we(["iconfont icon-right1",a.fileNameReal?"":"not-allow"]),onClick:_=>U(N)},null,10,Ke),c("span",{class:"iconfont icon-error",onClick:_=>W(N)},null,8,Ae)])):w("",!0),c("span",He,[a.showOp&&a.fileId&&a.status==2?(r(),y(j,{key:0},[c("span",{class:"iconfont icon-share1",onClick:_=>_e(a)},"分享",8,Je),a.folderType==0?(r(),y("span",{key:0,class:"iconfont icon-download",onClick:_=>ve(a)},"下载",8,Ge)):w("",!0),c("span",{class:"iconfont icon-del",onClick:_=>ce(a)},"删除",8,Qe),c("span",{class:"iconfont icon-edit",onClick:se(_=>C(N),["stop"])},"重命名",8,We),c("span",{class:"iconfont icon-move",onClick:_=>re(a)},"移动",8,Xe)],64)):w("",!0)])],40,qe)]),fileSize:o(({index:N,row:a})=>[a.fileSize?(r(),y("span",Ye,x(ie(d).Utils.size2Str(a.fileSize)),1)):w("",!0)]),_:1},8,["dataSource"])])):w("",!0),t(ye,{ref_key:"previewRef",ref:ee},null,512),t(ge,{ref_key:"folderSelectRef",ref:q,onFolderSelect:fe},null,512),t(Re,{ref_key:"shareRef",ref:te},null,512)])}}},Vl=Te(Ze,[["__scopeId","data-v-efbb7b35"]]);export{Vl as default};
